/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const R=Symbol("Comlink.proxy"),O=Symbol("Comlink.endpoint"),H=Symbol("Comlink.releaseProxy"),E=Symbol("Comlink.finalizer"),_=Symbol("Comlink.thrown"),S=e=>typeof e=="object"&&e!==null||typeof e=="function",N={canHandle:e=>S(e)&&e[R],serialize(e){const{port1:t,port2:r}=new MessageChannel;return z(e,t),[r,[r]]},deserialize(e){return e.start(),W(e)}},I={canHandle:e=>S(e)&&_ in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},C=new Map([["proxy",N],["throw",I]]);function V(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function z(e,t=globalThis,r=["*"]){t.addEventListener("message",function o(n){if(!n||!n.data)return;if(!V(r,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{id:f,type:a,path:s}=Object.assign({path:[]},n.data),i=(n.data.argumentList||[]).map(g);let l;try{const c=s.slice(0,-1).reduce((u,p)=>u[p],e),y=s.reduce((u,p)=>u[p],e);switch(a){case"GET":l=y;break;case"SET":c[s.slice(-1)[0]]=g(n.data.value),l=!0;break;case"APPLY":l=y.apply(c,i);break;case"CONSTRUCT":{const u=new y(...i);l=L(u)}break;case"ENDPOINT":{const{port1:u,port2:p}=new MessageChannel;z(e,p),l=q(u,[u])}break;case"RELEASE":l=void 0;break;default:return}}catch(c){l={value:c,[_]:0}}Promise.resolve(l).catch(c=>({value:c,[_]:0})).then(c=>{const[y,u]=b(c);t.postMessage(Object.assign(Object.assign({},y),{id:f}),u),a==="RELEASE"&&(t.removeEventListener("message",o),T(t),E in e&&typeof e[E]=="function"&&e[E]())}).catch(c=>{const[y,u]=b({value:new TypeError("Unserializable return value"),[_]:0});t.postMessage(Object.assign(Object.assign({},y),{id:f}),u)})}),t.start&&t.start()}function F(e){return e.constructor.name==="MessagePort"}function T(e){F(e)&&e.close()}function W(e,t){return P(e,[],t)}function m(e){if(e)throw new Error("Proxy has been released and is not useable")}function A(e){return d(e,{type:"RELEASE"}).then(()=>{T(e)})}const h=new WeakMap,w="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(h.get(e)||0)-1;h.set(e,t),t===0&&A(e)});function j(e,t){const r=(h.get(t)||0)+1;h.set(t,r),w&&w.register(e,t,e)}function D(e){w&&w.unregister(e)}function P(e,t=[],r=function(){}){let o=!1;const n=new Proxy(r,{get(f,a){if(m(o),a===H)return()=>{D(n),A(e),o=!0};if(a==="then"){if(t.length===0)return{then:()=>n};const s=d(e,{type:"GET",path:t.map(i=>i.toString())}).then(g);return s.then.bind(s)}return P(e,[...t,a])},set(f,a,s){m(o);const[i,l]=b(s);return d(e,{type:"SET",path:[...t,a].map(c=>c.toString()),value:i},l).then(g)},apply(f,a,s){m(o);const i=t[t.length-1];if(i===O)return d(e,{type:"ENDPOINT"}).then(g);if(i==="bind")return P(e,t.slice(0,-1));const[l,c]=k(s);return d(e,{type:"APPLY",path:t.map(y=>y.toString()),argumentList:l},c).then(g)},construct(f,a){m(o);const[s,i]=k(a);return d(e,{type:"CONSTRUCT",path:t.map(l=>l.toString()),argumentList:s},i).then(g)}});return j(n,e),n}function U(e){return Array.prototype.concat.apply([],e)}function k(e){const t=e.map(b);return[t.map(r=>r[0]),U(t.map(r=>r[1]))]}const M=new WeakMap;function q(e,t){return M.set(e,t),e}function L(e){return Object.assign(e,{[R]:!0})}function b(e){for(const[t,r]of C)if(r.canHandle(e)){const[o,n]=r.serialize(e);return[{type:"HANDLER",name:t,value:o},n]}return[{type:"RAW",value:e},M.get(e)||[]]}function g(e){switch(e.type){case"HANDLER":return C.get(e.name).deserialize(e.value);case"RAW":return e.value}}function d(e,t,r){return new Promise(o=>{const n=G();e.addEventListener("message",function f(a){!a.data||!a.data.id||a.data.id!==n||(e.removeEventListener("message",f),o(a.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:n},t),r)})}function G(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let Y=[0,1,2,3,4,5,6,7,8];const B=e=>({flop_analyzer:e.flop_analyzer.new(),results:null,reset(){this.flop_analyzer.reset()},setBoardCards(t){this.flop_analyzer.set_board_cards(t)},setPlayerCards(t,r){this.flop_analyzer.set_player_cards(t,r)},setPlayerRange(t,r){this.flop_analyzer.set_player_range(t,r)},setPlayerState(t,r){this.flop_analyzer.set_player_state(t,r)},clearPlayerCards(t){this.flop_analyzer.clear_player_cards(t)},initResults(){this.results=this.flop_analyzer.build_results(),console.log("initResults")},simulateFlop(t){if(!this.results){console.error("results not initialized");return}this.results=this.flop_analyzer.simulate_flop(t,this.results)},getResults(){console.log("getResults");const t=this.results;if(!t)return console.error("results falsy"),[];const r=t.get_num_players(),o=[];for(let n=0;n<r;++n){const f=[],a=[];for(let s=0;s<3;s++)f.push({equity:t.get_equity(n,s),rank_family_count:Y.map(i=>({perc:t.get_perc_family(n,s,i),better:t.get_perc_family_or_better(n,s,i)}))});for(let s=0;s<2;++s)a.push(t.get_street_draw(n,s));o.push({player_index:t.get_player_index(n),street_results:f,draw_results:a})}return o}});let x=null;const X=async e=>(x=await import("./poker_eval-1FZPhdVI.js"),await x.default(),L(B(x))),$=async()=>{};z({initHandler:X,beforeTerminate:$});
